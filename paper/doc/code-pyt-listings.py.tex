\begin{Verbatim}[commandchars=\\\{\}]
\PY{c}{\PYZsh{}listing00}
\PY{c}{\PYZsh{} code licensed under the terms of GNU GPL v3}
\PY{c}{\PYZsh{} copyright holder: University of Warsaw}
\PY{c}{\PYZsh{}listing01}
\PY{n}{real\PYZus{}t} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{float64}\PY{l+s}{\PYZsq{}}
\PY{c}{\PYZsh{}listing02}
\PY{k}{try}\PY{p}{:}
  \PY{k+kn}{import} \PY{n+nn}{numpypy}
  \PY{k+kn}{from} \PY{n+nn}{\PYZus{}numpypy.pypy} \PY{k+kn}{import} \PY{n}{set\PYZus{}invalidation}
  \PY{n}{set\PYZus{}invalidation}\PY{p}{(}\PY{n+nb+bp}{False}\PY{p}{)}
\PY{k}{except} \PY{n+ne}{ImportError}\PY{p}{:}
  \PY{k}{pass}
\PY{k+kn}{import} \PY{n+nn}{numpy}
\PY{k}{try}\PY{p}{:} 
  \PY{n}{numpy}\PY{o}{.}\PY{n}{seterr}\PY{p}{(}\PY{n+nb}{all}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ignore}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\PY{k}{except} \PY{n+ne}{AttributeError}\PY{p}{:}
  \PY{k}{pass}
\PY{c}{\PYZsh{}listing03}
\PY{k}{class} \PY{n+nc}{shift}\PY{p}{(}\PY{p}{)}\PY{p}{:}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{plus}\PY{p}{,} \PY{n}{mnus}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{plus} \PY{o}{=} \PY{n}{plus}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{mnus} \PY{o}{=} \PY{n}{mnus}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}radd\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{arg}\PY{p}{)}\PY{p}{:} 
    \PY{k}{return} \PY{n+nb}{type}\PY{p}{(}\PY{n}{arg}\PY{p}{)}\PY{p}{(}
      \PY{n}{arg}\PY{o}{.}\PY{n}{start} \PY{o}{+} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{plus}\PY{p}{,} 
      \PY{n}{arg}\PY{o}{.}\PY{n}{stop}  \PY{o}{+} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{plus}
    \PY{p}{)}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}rsub\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{arg}\PY{p}{)}\PY{p}{:} 
    \PY{k}{return} \PY{n+nb}{type}\PY{p}{(}\PY{n}{arg}\PY{p}{)}\PY{p}{(}
      \PY{n}{arg}\PY{o}{.}\PY{n}{start} \PY{o}{\PYZhy{}} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{mnus}\PY{p}{,} 
      \PY{n}{arg}\PY{o}{.}\PY{n}{stop}  \PY{o}{\PYZhy{}} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{mnus}
    \PY{p}{)}
\PY{c}{\PYZsh{}listing04}
\PY{n}{one} \PY{o}{=} \PY{n}{shift}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)} 
\PY{n}{hlf} \PY{o}{=} \PY{n}{shift}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{c}{\PYZsh{}listing05}
\PY{k}{def} \PY{n+nf}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{o}{*}\PY{n}{idx}\PY{p}{)}\PY{p}{:} 
  \PY{k}{return} \PY{p}{(}\PY{n}{idx}\PY{p}{[}\PY{n}{d}\PY{p}{]}\PY{p}{,} \PY{n}{idx}\PY{p}{[}\PY{n}{d}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{c}{\PYZsh{}listing06}
\PY{k}{def} \PY{n+nf}{f}\PY{p}{(}\PY{n}{psi\PYZus{}l}\PY{p}{,} \PY{n}{psi\PYZus{}r}\PY{p}{,} \PY{n}{C}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{p}{(}
    \PY{p}{(}\PY{n}{C} \PY{o}{+} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{psi\PYZus{}l} \PY{o}{+} 
    \PY{p}{(}\PY{n}{C} \PY{o}{\PYZhy{}} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{psi\PYZus{}r}
  \PY{p}{)} \PY{o}{/} \PY{l+m+mi}{2}
\PY{c}{\PYZsh{}listing07}
\PY{k}{def} \PY{n+nf}{donorcell}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{C}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{p}{(}
    \PY{n}{f}\PY{p}{(}
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,}     \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{,} 
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{,} 
        \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{hlf}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}
    \PY{p}{)} \PY{o}{\PYZhy{}} 
    \PY{n}{f}\PY{p}{(}
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{,} 
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,}     \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{,} 
        \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{hlf}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}
    \PY{p}{)} 
  \PY{p}{)}
\PY{c}{\PYZsh{}listing08}
\PY{k}{def} \PY{n+nf}{donorcell\PYZus{}op}\PY{p}{(}\PY{n}{psi}\PY{p}{,} \PY{n}{n}\PY{p}{,} \PY{n}{C}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
  \PY{n}{psi}\PY{p}{[}\PY{n}{n}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{psi}\PY{p}{[}\PY{n}{n}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{j}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{p}{(}
    \PY{n}{donorcell}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{psi}\PY{p}{[}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{C}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)} \PY{o}{+}
    \PY{n}{donorcell}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{psi}\PY{p}{[}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{C}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{j}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{p}{)}
\PY{c}{\PYZsh{}listing09}
\PY{k}{def} \PY{n+nf}{mpdata\PYZus{}frac}\PY{p}{(}\PY{n}{nom}\PY{p}{,} \PY{n}{den}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{n}{numpy}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{den} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{nom}\PY{o}{/}\PY{n}{den}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{c}{\PYZsh{}listing10}
\PY{k}{def} \PY{n+nf}{mpdata\PYZus{}A}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{n}{mpdata\PYZus{}frac}\PY{p}{(}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{,}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}
  \PY{p}{)}
\PY{c}{\PYZsh{}listing11}
\PY{k}{def} \PY{n+nf}{mpdata\PYZus{}B}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{n}{mpdata\PYZus{}frac}\PY{p}{(} 
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{\PYZhy{}}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{one}\PY{p}{)}\PY{p}{]}\PY{p}{,}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{+}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{one}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{one}\PY{p}{)}\PY{p}{]}
  \PY{p}{)} \PY{o}{/} \PY{l+m+mi}{2}
\PY{c}{\PYZsh{}listing12}
\PY{k}{def} \PY{n+nf}{mpdata\PYZus{}C\PYZus{}bar}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{C}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{p}{(}
    \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{hlf}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,}  \PY{n}{j}\PY{o}{+}\PY{n}{hlf}\PY{p}{)}\PY{p}{]} \PY{o}{+}
    \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{one}\PY{p}{,} \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{hlf}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{n}{C}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,}  \PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{hlf}\PY{p}{)}\PY{p}{]} 
  \PY{p}{)} \PY{o}{/} \PY{l+m+mi}{4}
\PY{c}{\PYZsh{}listing13}
\PY{k}{def} \PY{n+nf}{mpdata\PYZus{}C\PYZus{}adf}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{,} \PY{n}{C}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{p}{(}
    \PY{n+nb}{abs}\PY{p}{(}\PY{n}{C}\PY{p}{[}\PY{n}{d}\PY{p}{]}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{hlf}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{)} 
    \PY{o}{*} \PY{p}{(}\PY{l+m+mi}{1} \PY{o}{\PYZhy{}} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{C}\PY{p}{[}\PY{n}{d}\PY{p}{]}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{hlf}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)} 
    \PY{o}{*} \PY{n}{mpdata\PYZus{}A}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}
    \PY{o}{\PYZhy{}} \PY{n}{C}\PY{p}{[}\PY{n}{d}\PY{p}{]}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{hlf}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]} 
    \PY{o}{*} \PY{n}{mpdata\PYZus{}C\PYZus{}bar}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{C}\PY{p}{[}\PY{n}{d}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}
    \PY{o}{*} \PY{n}{mpdata\PYZus{}B}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}
  \PY{p}{)}
\PY{c}{\PYZsh{}listing14}
\PY{k}{def} \PY{n+nf}{ext}\PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{n}\PY{p}{)}\PY{p}{:}
  \PY{k}{if} \PY{p}{(}\PY{n+nb}{type}\PY{p}{(}\PY{n}{n}\PY{p}{)} \PY{o}{==} \PY{n+nb}{int}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{n} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:} 
    \PY{n}{n} \PY{o}{=} \PY{n}{one}
  \PY{k}{return} \PY{n+nb}{slice}\PY{p}{(}
    \PY{p}{(}\PY{n}{r} \PY{o}{\PYZhy{}} \PY{n}{n}\PY{p}{)}\PY{o}{.}\PY{n}{start}\PY{p}{,} 
    \PY{p}{(}\PY{n}{r} \PY{o}{+} \PY{n}{n}\PY{p}{)}\PY{o}{.}\PY{n}{stop}
  \PY{p}{)}
\PY{c}{\PYZsh{}listing15}
\PY{k}{class} \PY{n+nc}{solver}\PY{p}{(}\PY{n+nb}{object}\PY{p}{)}\PY{p}{:}
  \PY{c}{\PYZsh{} ctor\PYZhy{}like method}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{bcx}\PY{p}{,} \PY{n}{bcy}\PY{p}{,} \PY{n}{nx}\PY{p}{,} \PY{n}{ny}\PY{p}{,} \PY{n}{hlo}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n} \PY{o}{=} \PY{l+m+mi}{0}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo} \PY{o}{=} \PY{n}{hlo}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{hlo}\PY{p}{,} \PY{n}{nx} \PY{o}{+} \PY{n}{hlo}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{hlo}\PY{p}{,} \PY{n}{ny} \PY{o}{+} \PY{n}{hlo}\PY{p}{)}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcx} \PY{o}{=} \PY{n}{bcx}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n}{hlo}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcy} \PY{o}{=} \PY{n}{bcy}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n}{hlo}\PY{p}{)}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi} \PY{o}{=} \PY{p}{(}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{p}{(}
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}\PY{p}{,} 
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}
      \PY{p}{)}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}\PY{p}{,}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{p}{(}
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}\PY{p}{,} 
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}
      \PY{p}{)}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}
    \PY{p}{)}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C} \PY{o}{=} \PY{p}{(}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{p}{(}
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n}{hlf}\PY{p}{)}\PY{o}{.}\PY{n}{stop}\PY{p}{,} 
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}
      \PY{p}{)}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}\PY{p}{,}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{p}{(}
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}\PY{o}{.}\PY{n}{stop}\PY{p}{,} 
        \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n}{hlf}\PY{p}{)}\PY{o}{.}\PY{n}{stop}
      \PY{p}{)}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}
    \PY{p}{)}

  \PY{c}{\PYZsh{} accessor methods}
  \PY{k}{def} \PY{n+nf}{state}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{]}

  \PY{c}{\PYZsh{} helper methods invoked by solve()}
  \PY{k}{def} \PY{n+nf}{courant}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{d}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{[}\PY{n}{d}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{]}

  \PY{k}{def} \PY{n+nf}{cycle}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}  \PY{o}{=} \PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZpc{}} \PY{l+m+mi}{2} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}

   \PY{c}{\PYZsh{} integration logic}
  \PY{k}{def} \PY{n+nf}{solve}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{nt}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{nt}\PY{p}{)}\PY{p}{:}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcx}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}
      \PY{p}{)}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcy}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}
      \PY{p}{)}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{advop}\PY{p}{(}\PY{p}{)} 
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{cycle}\PY{p}{(}\PY{p}{)}
  
\PY{c}{\PYZsh{}listing16}
\PY{k}{class} \PY{n+nc}{cyclic}\PY{p}{(}\PY{n+nb}{object}\PY{p}{)}\PY{p}{:}
  \PY{c}{\PYZsh{} ctor}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{d}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{hlo}\PY{p}{)}\PY{p}{:} 
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{d} \PY{o}{=} \PY{n}{d}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{left\PYZus{}halo} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{i}\PY{o}{.}\PY{n}{start}\PY{o}{\PYZhy{}}\PY{n}{hlo}\PY{p}{,} \PY{n}{i}\PY{o}{.}\PY{n}{start}    \PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{rght\PYZus{}edge} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{i}\PY{o}{.}\PY{n}{stop} \PY{o}{\PYZhy{}}\PY{n}{hlo}\PY{p}{,} \PY{n}{i}\PY{o}{.}\PY{n}{stop}     \PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{rght\PYZus{}halo} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{i}\PY{o}{.}\PY{n}{stop}\PY{p}{,}      \PY{n}{i}\PY{o}{.}\PY{n}{stop} \PY{o}{+}\PY{n}{hlo}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{left\PYZus{}edge} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{i}\PY{o}{.}\PY{n}{start}\PY{p}{,}     \PY{n}{i}\PY{o}{.}\PY{n}{start}\PY{o}{+}\PY{n}{hlo}\PY{p}{)}

  \PY{c}{\PYZsh{} method invoked by the solver}
  \PY{k}{def} \PY{n+nf}{fill\PYZus{}halos}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{psi}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{:}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{d}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{left\PYZus{}halo}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]} \PY{o}{=} \PY{p}{(}
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{d}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{rght\PYZus{}edge}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}
    \PY{p}{)}
    \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{d}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{rght\PYZus{}halo}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]} \PY{o}{=} \PY{p}{(}
      \PY{n}{psi}\PY{p}{[}\PY{n}{pi}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{d}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{left\PYZus{}edge}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{]}
    \PY{p}{)}

\PY{c}{\PYZsh{}listing17}
\PY{k}{class} \PY{n+nc}{solver\PYZus{}donorcell}\PY{p}{(}\PY{n}{solver}\PY{p}{)}\PY{p}{:}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{bcx}\PY{p}{,} \PY{n}{bcy}\PY{p}{,} \PY{n}{nx}\PY{p}{,} \PY{n}{ny}\PY{p}{)}\PY{p}{:}
    \PY{n}{solver}\PY{o}{.}\PY{n}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{bcx}\PY{p}{,} \PY{n}{bcy}\PY{p}{,} \PY{n}{nx}\PY{p}{,} \PY{n}{ny}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{advop}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
    \PY{n}{donorcell\PYZus{}op}\PY{p}{(}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{,} 
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}
    \PY{p}{)}
\PY{c}{\PYZsh{}listing18}
\PY{k}{class} \PY{n+nc}{solver\PYZus{}mpdata}\PY{p}{(}\PY{n}{solver}\PY{p}{)}\PY{p}{:}
  \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{n\PYZus{}iters}\PY{p}{,} \PY{n}{bcx}\PY{p}{,} \PY{n}{bcy}\PY{p}{,} \PY{n}{nx}\PY{p}{,} \PY{n}{ny}\PY{p}{)}\PY{p}{:}
    \PY{n}{solver}\PY{o}{.}\PY{n}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{bcx}\PY{p}{,} \PY{n}{bcy}\PY{p}{,} \PY{n}{nx}\PY{p}{,} \PY{n}{ny}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{im} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{o}{.}\PY{n}{start}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{o}{.}\PY{n}{stop}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{jm} \PY{o}{=} \PY{n+nb}{slice}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{o}{.}\PY{n}{start}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{o}{.}\PY{n}{stop}\PY{p}{)}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n\PYZus{}iters} \PY{o}{=} \PY{n}{n\PYZus{}iters}
  
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp} \PY{o}{=} \PY{p}{[}\PY{p}{(}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}\PY{p}{,}
      \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}
    \PY{p}{)}\PY{p}{]}
    \PY{k}{if} \PY{n}{n\PYZus{}iters} \PY{o}{\PYZgt{}} \PY{l+m+mi}{2}\PY{p}{:}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}
        \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}\PY{p}{,}
        \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{real\PYZus{}t}\PY{p}{)}
      \PY{p}{)}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{advop}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{step} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n\PYZus{}iters}\PY{p}{)}\PY{p}{:}
      \PY{k}{if} \PY{n}{step} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{donorcell\PYZus{}op}\PY{p}{(}
          \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}
        \PY{p}{)}
      \PY{k}{else}\PY{p}{:}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{cycle}\PY{p}{(}\PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcx}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}
          \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}
        \PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcy}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}
          \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{hlo}\PY{p}{)}
        \PY{p}{)}
        \PY{k}{if} \PY{n}{step} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
          \PY{n}{C\PYZus{}unco}\PY{p}{,} \PY{n}{C\PYZus{}corr} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{C}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{k}{elif} \PY{n}{step} \PY{o}{\PYZpc{}} \PY{l+m+mi}{2}\PY{p}{:}
          \PY{n}{C\PYZus{}unco}\PY{p}{,} \PY{n}{C\PYZus{}corr} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{k}{else}\PY{p}{:}
          \PY{n}{C\PYZus{}unco}\PY{p}{,} \PY{n}{C\PYZus{}corr} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{tmp}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}

        \PY{n}{C\PYZus{}corr}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{im}\PY{o}{+}\PY{n}{hlf}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{mpdata\PYZus{}C\PYZus{}adf}\PY{p}{(}
          \PY{l+m+mi}{0}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{im}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n}{C\PYZus{}unco}
        \PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcy}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}\PY{n}{C\PYZus{}corr}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n}{hlf}\PY{p}{)}\PY{p}{)}
        
        \PY{n}{C\PYZus{}corr}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{jm}\PY{o}{+}\PY{n}{hlf}\PY{p}{]} \PY{o}{=} \PY{n}{mpdata\PYZus{}C\PYZus{}adf}\PY{p}{(}
          \PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{jm}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n}{C\PYZus{}unco}
        \PY{p}{)}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{bcx}\PY{o}{.}\PY{n}{fill\PYZus{}halos}\PY{p}{(}\PY{n}{C\PYZus{}corr}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{ext}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}\PY{p}{,} \PY{n}{hlf}\PY{p}{)}\PY{p}{)}

        \PY{n}{donorcell\PYZus{}op}\PY{p}{(}
          \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{psi}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{n}\PY{p}{,} \PY{n}{C\PYZus{}corr}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{i}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{j}
        \PY{p}{)}
\PY{c}{\PYZsh{}listing19}
\end{Verbatim}
